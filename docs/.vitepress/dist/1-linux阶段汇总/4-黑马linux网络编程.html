<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>day11 | mycpp-note</title>
    <meta name="description" content="xinghuai的学习笔记">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/mycppnoteweb/assets/style.DbrLBEdr.css" as="style">
    <link rel="preload stylesheet" href="/mycppnoteweb/vp-icons.css" as="style">
    
    <script type="module" src="/mycppnoteweb/assets/app.XlNjfzUR.js"></script>
    <link rel="preload" href="/mycppnoteweb/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/mycppnoteweb/assets/chunks/theme.BFLFnTQ5.js">
    <link rel="modulepreload" href="/mycppnoteweb/assets/chunks/framework.MzfCtVj-.js">
    <link rel="modulepreload" href="/mycppnoteweb/assets/1-linux阶段汇总_4-黑马linux网络编程.md.piWqOmPQ.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1b770e11><!--[--><!--]--><!--[--><span tabindex="-1" data-v-cc7de52e></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-cc7de52e>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1b770e11 data-v-bbb74e5a><div class="VPNavBar" data-v-bbb74e5a data-v-d05d792e><div class="wrapper" data-v-d05d792e><div class="container" data-v-d05d792e><div class="title" data-v-d05d792e><div class="VPNavBarTitle has-sidebar" data-v-d05d792e data-v-43580379><a class="title" href="/mycppnoteweb/" data-v-43580379><!--[--><!--]--><!----><span data-v-43580379>mycpp-note</span><!--[--><!--]--></a></div></div><div class="content" data-v-d05d792e><div class="content-body" data-v-d05d792e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-d05d792e><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-d05d792e data-v-8d00cc26><span id="main-nav-aria-label" class="visually-hidden" data-v-8d00cc26> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mycppnoteweb/" tabindex="0" data-v-8d00cc26 data-v-5337c0c4><!--[--><span data-v-5337c0c4>home</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-8d00cc26 data-v-3996b80d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3996b80d><span class="text" data-v-3996b80d><!----><span data-v-3996b80d>linux</span><span class="vpi-chevron-down text-icon" data-v-3996b80d></span></span></button><div class="menu" data-v-3996b80d><div class="VPMenu" data-v-3996b80d data-v-f4d7e8ec><div class="items" data-v-f4d7e8ec><!--[--><!--[--><div class="VPMenuGroup" data-v-f4d7e8ec data-v-3254d667><p class="title" data-v-3254d667>系统编程</p><!--[--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/1-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0-%E7%BB%93%E5%90%88%E8%AF%BE%E4%BB%B6%E7%9C%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>系统编程-1</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/2-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>系统编程-2</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/3-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>系统编程-3</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-f4d7e8ec data-v-3254d667><p class="title" data-v-3254d667>网络编程</p><!--[--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link active" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/4-%E9%BB%91%E9%A9%AClinux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>网络编程-1</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/5-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>网络编程-2</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/6-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>网络编程-3</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/7-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>网络编程-4</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/8-%E7%B3%BB%E7%BB%9F+%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%A0%81%E7%BB%83%E4%B9%A0%E6%B1%87%E6%80%BB.html" data-v-623661b5><!--[--><span data-v-623661b5>练习代码</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8d00cc26 data-v-3996b80d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3996b80d><span class="text" data-v-3996b80d><!----><span data-v-3996b80d>cpp</span><span class="vpi-chevron-down text-icon" data-v-3996b80d></span></span></button><div class="menu" data-v-3996b80d><div class="VPMenu" data-v-3996b80d data-v-f4d7e8ec><div class="items" data-v-f4d7e8ec><!--[--><!--[--><div class="VPMenuGroup" data-v-f4d7e8ec data-v-3254d667><p class="title" data-v-3254d667>cpp中级</p><!--[--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/1-%E4%B8%AD%E7%BA%A7c++%E7%AC%94%E8%AE%B0-1.html" data-v-623661b5><!--[--><span data-v-623661b5>cpp中级-1</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/1-%E4%B8%AD%E7%BA%A7c++%E7%AC%94%E8%AE%B0-2.html" data-v-623661b5><!--[--><span data-v-623661b5>cpp中级-2</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/1-%E4%B8%AD%E7%BA%A7%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB.html" data-v-623661b5><!--[--><span data-v-623661b5>中级面试</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-f4d7e8ec data-v-3254d667><p class="title" data-v-3254d667>cpp高级</p><!--[--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/2-%E9%AB%98%E7%BA%A7c++%E7%AC%94%E8%AE%B0-1.html" data-v-623661b5><!--[--><span data-v-623661b5>cpp高级-1</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/2-%E9%AB%98%E7%BA%A7c++%E7%AC%94%E8%AE%B0-2.html" data-v-623661b5><!--[--><span data-v-623661b5>cpp高级-2</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0.html" data-v-623661b5><!--[--><span data-v-623661b5>回调函数</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-3254d667 data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/%E5%9B%9E%E9%A1%BElinux%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B.html" data-v-623661b5><!--[--><span data-v-623661b5>回顾linux的多线程</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8d00cc26 data-v-3996b80d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3996b80d><span class="text" data-v-3996b80d><!----><span data-v-3996b80d>数据结构</span><span class="vpi-chevron-down text-icon" data-v-3996b80d></span></span></button><div class="menu" data-v-3996b80d><div class="VPMenu" data-v-3996b80d data-v-f4d7e8ec><div class="items" data-v-f4d7e8ec><!--[--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" data-v-623661b5><!--[--><span data-v-623661b5>数据结构-1</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84(%E4%BA%94%E5%A4%A7%E7%AE%97%E6%B3%95%E4%B9%8B%E5%90%8E).html" data-v-623661b5><!--[--><span data-v-623661b5>数据结构-2</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/数据结构/C++版数据结构和算法课程.pdf" data-v-623661b5><!--[--><span data-v-623661b5>老师pdf</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/数据结构/红黑树删除节点 - Hide on bush.pdf" data-v-623661b5><!--[--><span data-v-623661b5>红黑树扩展</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%B0%8F%E8%A1%A5%E5%85%85.html" data-v-623661b5><!--[--><span data-v-623661b5>数据结构小补充</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8d00cc26 data-v-3996b80d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3996b80d><span class="text" data-v-3996b80d><!----><span data-v-3996b80d>项目</span><span class="vpi-chevron-down text-icon" data-v-3996b80d></span></span></button><div class="menu" data-v-3996b80d><div class="VPMenu" data-v-3996b80d data-v-f4d7e8ec><div class="items" data-v-f4d7e8ec><!--[--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/markdown-examples.html" data-v-623661b5><!--[--><span data-v-623661b5>集群聊天服务器</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/api-examples.html" data-v-623661b5><!--[--><span data-v-623661b5>mprpc框架</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-8d00cc26 data-v-3996b80d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3996b80d><span class="text" data-v-3996b80d><!----><span data-v-3996b80d>mysql</span><span class="vpi-chevron-down text-icon" data-v-3996b80d></span></span></button><div class="menu" data-v-3996b80d><div class="VPMenu" data-v-3996b80d data-v-f4d7e8ec><div class="items" data-v-f4d7e8ec><!--[--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E6%96%BD%E7%A3%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%B8%E5%BF%83/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0.html" data-v-623661b5><!--[--><span data-v-623661b5>mysql-1</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-f4d7e8ec data-v-623661b5><a class="VPLink link" href="/mycppnoteweb/%E6%96%BD%E7%A3%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%B8%E5%BF%83/2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" data-v-623661b5><!--[--><span data-v-623661b5>常用命令小总结</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-d05d792e data-v-9cfff6f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-9cfff6f0 data-v-ab887738 data-v-fb8e66d1><span class="check" data-v-fb8e66d1><span class="icon" data-v-fb8e66d1><!--[--><span class="vpi-sun sun" data-v-ab887738></span><span class="vpi-moon moon" data-v-ab887738></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-d05d792e data-v-efb95778 data-v-9092002d><!--[--><a class="VPSocialLink no-icon" href="https://github.com/xinghuaiaaa/mycpp-note" aria-label="github" target="_blank" rel="noopener" data-v-9092002d data-v-4e920967><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-d05d792e data-v-b33bc18e data-v-3996b80d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3996b80d><span class="vpi-more-horizontal icon" data-v-3996b80d></span></button><div class="menu" data-v-3996b80d><div class="VPMenu" data-v-3996b80d data-v-f4d7e8ec><!----><!--[--><!--[--><!----><div class="group" data-v-b33bc18e><div class="item appearance" data-v-b33bc18e><p class="label" data-v-b33bc18e>Appearance</p><div class="appearance-action" data-v-b33bc18e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-b33bc18e data-v-ab887738 data-v-fb8e66d1><span class="check" data-v-fb8e66d1><span class="icon" data-v-fb8e66d1><!--[--><span class="vpi-sun sun" data-v-ab887738></span><span class="vpi-moon moon" data-v-ab887738></span><!--]--></span></span></button></div></div></div><div class="group" data-v-b33bc18e><div class="item social-links" data-v-b33bc18e><div class="VPSocialLinks social-links-list" data-v-b33bc18e data-v-9092002d><!--[--><a class="VPSocialLink no-icon" href="https://github.com/xinghuaiaaa/mycpp-note" aria-label="github" target="_blank" rel="noopener" data-v-9092002d data-v-4e920967><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-d05d792e data-v-b529eeb3><span class="container" data-v-b529eeb3><span class="top" data-v-b529eeb3></span><span class="middle" data-v-b529eeb3></span><span class="bottom" data-v-b529eeb3></span></span></button></div></div></div></div><div class="divider" data-v-d05d792e><div class="divider-line" data-v-d05d792e></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-1b770e11 data-v-b812724c><div class="container" data-v-b812724c><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b812724c><span class="vpi-align-left menu-icon" data-v-b812724c></span><span class="menu-text" data-v-b812724c>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b812724c data-v-fb1f2e36><button data-v-fb1f2e36>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-1b770e11 data-v-cebeea32><div class="curtain" data-v-cebeea32></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-cebeea32><span class="visually-hidden" id="sidebar-aria-label" data-v-cebeea32> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-7e8499e1><section class="VPSidebarItem level-0 has-active" data-v-7e8499e1 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h2 class="text" data-v-ac921fd9>linux</h2><!----></div><div class="items" data-v-ac921fd9><!--[--><section class="VPSidebarItem level-1 collapsible" data-v-ac921fd9 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h3 class="text" data-v-ac921fd9>系统编程</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-ac921fd9><span class="vpi-chevron-right caret-icon" data-v-ac921fd9></span></div></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/1-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0-%E7%BB%93%E5%90%88%E8%AF%BE%E4%BB%B6%E7%9C%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>系统编程-1</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/2-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>系统编程-2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/3-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>系统编程-3</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible has-active" data-v-ac921fd9 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h3 class="text" data-v-ac921fd9>网络编程</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-ac921fd9><span class="vpi-chevron-right caret-icon" data-v-ac921fd9></span></div></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/4-%E9%BB%91%E9%A9%AClinux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>网络编程-1</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/5-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>网络编程-2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/6-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>网络编程-3</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/7-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>网络编程-4</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/8-%E7%B3%BB%E7%BB%9F+%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%A0%81%E7%BB%83%E4%B9%A0%E6%B1%87%E6%80%BB.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>练习代码</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-7e8499e1><section class="VPSidebarItem level-0" data-v-7e8499e1 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h2 class="text" data-v-ac921fd9>cpp</h2><!----></div><div class="items" data-v-ac921fd9><!--[--><section class="VPSidebarItem level-1 collapsible" data-v-ac921fd9 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h3 class="text" data-v-ac921fd9>cpp中级</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-ac921fd9><span class="vpi-chevron-right caret-icon" data-v-ac921fd9></span></div></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/1-%E4%B8%AD%E7%BA%A7c++%E7%AC%94%E8%AE%B0-1.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>cpp中级-1</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/1-%E4%B8%AD%E7%BA%A7c++%E7%AC%94%E8%AE%B0-2.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>cpp中级-2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/1-%E4%B8%AD%E7%BA%A7%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>中级面试</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible" data-v-ac921fd9 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h3 class="text" data-v-ac921fd9>cpp高级</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-ac921fd9><span class="vpi-chevron-right caret-icon" data-v-ac921fd9></span></div></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/2-%E9%AB%98%E7%BA%A7c++%E7%AC%94%E8%AE%B0-1.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>cpp高级-1</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/2-%E9%AB%98%E7%BA%A7c++%E7%AC%94%E8%AE%B0-2.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>cpp高级-2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>回调函数</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E4%B8%AD%E9%AB%98%E7%BA%A7c++%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-md/%E5%9B%9E%E9%A1%BElinux%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>回顾linux的多线程</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-7e8499e1><section class="VPSidebarItem level-0" data-v-7e8499e1 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h2 class="text" data-v-ac921fd9>数据结构</h2><!----></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>数据结构-1</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84(%E4%BA%94%E5%A4%A7%E7%AE%97%E6%B3%95%E4%B9%8B%E5%90%8E).html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>数据结构-2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/数据结构/C++版数据结构和算法课程.pdf" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>老师pdf</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/数据结构/红黑树删除节点 - Hide on bush.pdf" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>红黑树扩展</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%B0%8F%E8%A1%A5%E5%85%85.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>数据结构小补充</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-7e8499e1><section class="VPSidebarItem level-0" data-v-7e8499e1 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h2 class="text" data-v-ac921fd9>项目</h2><!----></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/markdown-examples.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>集群聊天服务器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/api-examples.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>mprpc框架</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-7e8499e1><section class="VPSidebarItem level-0" data-v-7e8499e1 data-v-ac921fd9><div class="item" role="button" tabindex="0" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><h2 class="text" data-v-ac921fd9>mysql</h2><!----></div><div class="items" data-v-ac921fd9><!--[--><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E6%96%BD%E7%A3%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%B8%E5%BF%83/1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-ac921fd9 data-v-ac921fd9><div class="item" data-v-ac921fd9><div class="indicator" data-v-ac921fd9></div><a class="VPLink link link" href="/mycppnoteweb/%E6%96%BD%E7%A3%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%B8%E5%BF%83/2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" data-v-ac921fd9><!--[--><p class="text" data-v-ac921fd9>常用命令小总结</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1b770e11 data-v-50f9c880><div class="VPDoc has-sidebar has-aside" data-v-50f9c880 data-v-37be3093><!--[--><!--]--><div class="container" data-v-37be3093><div class="aside" data-v-37be3093><div class="aside-curtain" data-v-37be3093></div><div class="aside-container" data-v-37be3093><div class="aside-content" data-v-37be3093><div class="VPDocAside" data-v-37be3093 data-v-afd94ee1><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-afd94ee1 data-v-8b2eb27d><div class="content" data-v-8b2eb27d><div class="outline-marker" data-v-8b2eb27d></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-8b2eb27d>On this page</div><ul class="VPDocOutlineItem root" data-v-8b2eb27d data-v-f15281db><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-afd94ee1></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37be3093><div class="content-container" data-v-37be3093><!--[--><!--]--><main class="main" data-v-37be3093><div style="position:relative;" class="vp-doc _mycppnoteweb_1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB_4-%E9%BB%91%E9%A9%AClinux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B" data-v-37be3093><div><h1 id="day11" tabindex="-1">day11 <a class="header-anchor" href="#day11" aria-label="Permalink to &quot;day11&quot;">​</a></h1><h2 id="%E5%8D%8F%E8%AE%AE%EF%BC%9A" tabindex="-1">协议： <a class="header-anchor" href="#协议：" aria-label="Permalink to &quot;协议：&quot;">​</a></h2><p>​ 一组规则。</p><h2 id="%E5%88%86%E5%B1%82%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84%EF%BC%9A" tabindex="-1">分层模型结构： <a class="header-anchor" href="#分层模型结构：" aria-label="Permalink to &quot;分层模型结构：&quot;">​</a></h2><pre><code>OSI七层模型：  物、数、网、传、会、表、应

TCP/IP 4层模型：网（链路层/网络接口层）、网、传、应

	应用层：http、ftp、nfs、ssh、telnet。。。

	传输层：TCP、UDP

	网络层：IP、ICMP、IGMP

	链路层：以太网帧协议、ARP
</code></pre><h2 id="c%2Fs%E6%A8%A1%E5%9E%8B--%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A" tabindex="-1">c/s模型--客户端-服务器： <a class="header-anchor" href="#c%2Fs模型--客户端-服务器：" aria-label="Permalink to &quot;c/s模型--客户端-服务器：&quot;">​</a></h2><pre><code>client-server
</code></pre><h2 id="b%2Fs%E6%A8%A1%E5%9E%8B--%E6%B5%8F%E8%A7%88%E5%99%A8-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A" tabindex="-1">b/s模型--浏览器-服务器： <a class="header-anchor" href="#b%2Fs模型--浏览器-服务器：" aria-label="Permalink to &quot;b/s模型--浏览器-服务器：&quot;">​</a></h2><pre><code>browser-server
</code></pre><p>​</p><table tabindex="0"><thead><tr><th></th><th>C/S</th><th>B/S</th></tr></thead><tbody><tr><td>优点：</td><td>缓存大量数据、协议选择灵活</td><td>安全性、跨平台、开发工作量较小速度快</td></tr><tr><td>缺点：</td><td>安全性、跨平台、开发工作量较大</td><td>不能缓存大量数据、严格遵守 http</td></tr><tr><td></td><td>需要安装 客户端</td><td></td></tr></tbody></table><h2 id="%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B%EF%BC%9A" tabindex="-1">网络传输流程： <a class="header-anchor" href="#网络传输流程：" aria-label="Permalink to &quot;网络传输流程：&quot;">​</a></h2><pre><code>数据没有封装之前，是不能在网络中传递。

数据-》应用层-》传输层-》网络层-》链路层  --- 网络环境
</code></pre><p>​</p><h2 id="%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E5%8D%8F%E8%AE%AE%EF%BC%9A" tabindex="-1">以太网帧协议： <a class="header-anchor" href="#以太网帧协议：" aria-label="Permalink to &quot;以太网帧协议：&quot;">​</a></h2><pre><code>ARP协议：根据 Ip 地址获取 mac 地址。

以太网帧协议：根据mac地址，完成数据包传输。
</code></pre><h2 id="IP%E5%8D%8F%E8%AE%AE%EF%BC%9A" tabindex="-1">IP协议： <a class="header-anchor" href="#IP协议：" aria-label="Permalink to &quot;IP协议：&quot;">​</a></h2><pre><code>版本： IPv4、IPv6  -- 4位

TTL： time to live 。 设置数据包在路由节点中的跳转上限。每经过一个路由节点，该值-1， 减为0的路由，有义务将该数据包丢弃

源IP： 32位。--- 4字节		192.168.1.108 --- 点分十进制 IP地址（string）  --- 二进制 

目的IP：32位。--- 4字节
</code></pre><blockquote><p>IP地址：可以在网络环境中，唯一标识一台主机。</p><p>端口号：可以网络的一台主机上，唯一标识一个进程。</p><p>ip地址+端口号：可以在网络环境中，唯一标识一个进程。</p></blockquote><h2 id="UDP%EF%BC%9A" tabindex="-1">UDP： <a class="header-anchor" href="#UDP：" aria-label="Permalink to &quot;UDP：&quot;">​</a></h2><p>​ 16位：源端口号。 2^16 = 65536</p><pre><code>16位：目的端口号。
</code></pre><h2 id="TCP%E5%8D%8F%E8%AE%AE%EF%BC%9A%E8%AE%B0%E4%BD%8F" tabindex="-1">TCP协议：记住 <a class="header-anchor" href="#TCP协议：记住" aria-label="Permalink to &quot;TCP协议：记住&quot;">​</a></h2><pre><code>16位：源端口号。	2^16 = 65536  

16位：目的端口号。

32序号;

32确认序号。	

6个标志位。

16位窗口大小。	2^16 = 65536 
</code></pre><hr><h1 id="socket-1" tabindex="-1">socket-1 <a class="header-anchor" href="#socket-1" aria-label="Permalink to &quot;socket-1&quot;">​</a></h1><h2 id="%E7%BD%91%E7%BB%9C%E5%A5%97%E6%8E%A5%E5%AD%97%EF%BC%9A%20%20socket(%E4%B8%AD%E6%96%87%20%E6%8F%92%E5%BA%A7%E7%9A%84%E6%84%8F%E6%80%9D)" tabindex="-1">网络套接字： socket(中文 插座的意思) <a class="header-anchor" href="#网络套接字：  socket(中文 插座的意思)" aria-label="Permalink to &quot;网络套接字：  socket(中文 插座的意思)&quot;">​</a></h2><pre><code>一个文件描述符指向一个套接字（该套接字内部由内核借助两个缓冲区实现。）

在通信过程中， 套接字一定是成对出现的。 有插 座,就得有插头
一堆套接字
</code></pre><h2 id="%E7%BD%91%E7%BB%9C%E5%AD%97%E8%8A%82%E5%BA%8F%E5%87%BD%E6%95%B0%EF%BC%9A" tabindex="-1">网络字节序函数： <a class="header-anchor" href="#网络字节序函数：" aria-label="Permalink to &quot;网络字节序函数：&quot;">​</a></h2><p><strong>网络字节序</strong>是指在网络通信中使用的一种标准的字节排列方式，规定了多字节数据的高字节在前，低字节在后的排列方式，即 <strong>大端字节序 (Big-Endian)</strong>。这种格式被广泛用于网络协议，以确保不同系统之间数据的正确传输和解析。</p><pre><code>小端法：（pc本地存储）	高位存高地址。地位存低地址。	int a = 0x12345678

大端法：（网络存储）	高位存低地址。地位存高地址。

htonl --&gt; 本地--》网络 （IP）			192.168.1.11 --&gt; string --&gt; atoi --&gt; int --&gt; htonl --&gt; 网络字节序

将主机字节序的 32 位整数（long 类型，通常为 uint32_t）转换为网络字节序（大端字节序）。

htons --&gt; 本地--》网络 (port) 

ntohl --&gt; 网络--》 本地（IP）

ntohs --&gt; 网络--》 本地（Port）

一个 IPv4 地址由 32 位表示。
端口号由 16 位表示。
因此 转到port 大多是 short
转到 网络 大多是 long
</code></pre><blockquote><p>由于 小端到大端, 不能直接读, 所以需要转换</p></blockquote><blockquote><p>host to network long 32位 h-to-n-l</p><p>host to network short 16位</p><p>htons</p><p>以及反过来</p></blockquote><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> hostlong</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="atoi" tabindex="-1">atoi <a class="header-anchor" href="#atoi" aria-label="Permalink to &quot;atoi&quot;">​</a></h2><p><code>atoi</code> 是 C 标准库中的一个函数，用于将字符串转换为整数。它的名称来源于 &quot;ASCII to integer&quot;。</p><h2 id="IP%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0inet_pton%EF%BC%9A" tabindex="-1">IP地址转换函数inet_pton： <a class="header-anchor" href="#IP地址转换函数inet_pton：" aria-label="Permalink to &quot;IP地址转换函数inet_pton：&quot;">​</a></h2><blockquote><p>一般的:</p><p>192.168.1.1 -&gt; string -&gt;atoi -&gt; int -&gt; htonl -&gt; 网络字节序</p><p>扎样太麻烦烦, 下面是整合的 函数</p></blockquote><p><code>inet_pton</code> 是一个在 C 语言中用于将字符串形式的 IP 地址转换为二进制形式的函数，适用于 IPv4 和 IPv6 地址。其名称来源于 <strong>&quot;presentation to network&quot;</strong>（表示形式到网络字节序）。</p><pre><code>int inet_pton(int af, const char *src, void *dst);		本地字节序（string IP） ---&gt; 网络字节序

	af：AF_INET(代表ipv4)、AF_INET6(代表ipv6)

	src：传入，IP地址（点分十进制）

	dst：传出，转换后的 网络字节序的 IP地址。   

	返回值：

		成功： 1

		异常： 0， 说明src指向的不是一个有效的ip地址。

		失败：-1
		
		inet_pton（） 成功时返回 1（网络地址已成功转换）。如果 src 不包含表示指定地址族中有效网络地址的字符串，则返回 0。如果 af 不包含有效的地址系列，则返回 -1 并将 errno 设置为 EAFNOSUPPORT。
</code></pre><p>​ ​ ​ const char *inet_ntop(int af, const void *src, char *dst, socklen_t size); 网络字节序 ---&gt; 本地字节序（string IP） ​ ​ af：AF_INET、AF_INET6 ​ ​ src: 网络字节序IP地址 ​ dst：本地字节序（string IP）</p><pre><code>	size： dst 的大小。 缓冲区大小

	返回值： 成功：dst。 	

		失败：NULL
</code></pre><h2 id="sockaddr%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84--%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%EF%BC%9A" tabindex="-1">sockaddr地址结构--函数参数： <a class="header-anchor" href="#sockaddr地址结构--函数参数：" aria-label="Permalink to &quot;sockaddr地址结构--函数参数：&quot;">​</a></h2><p>IP + port --&gt; 在网络环境中唯一标识一个进程。</p><blockquote><p>man 7 ip 查看 该结构</p></blockquote><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    sa_family_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sin_family;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* address family: AF_INET */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    in_port_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      sin_port;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   /* port in network byte order */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> in_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sin_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   /* internet address */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Internet address */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> in_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       s_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     /* address in network byte order */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">参1: 网络类型  ipv4 ipv6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">参2: 端口的网络字节序 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">---</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> htons   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    表示端口号。端口号是 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 位整数，但需要以 网络字节序（大端字节序）存储，因此通常使用 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() 函数将主机字节序转换为网络字节序。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">参3: 网络地址 使用整合的 inet_pton   不是点分十进制</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    在计算机内部和网络传输中，网络地址通常使用 二进制形式，并按照 网络字节序（大端字节序）进行存储和传输。</span></span></code></pre></div><h3 id="%E7%94%A8%E6%B3%95%3A" tabindex="-1">用法: <a class="header-anchor" href="#用法%3A" aria-label="Permalink to &quot;用法:&quot;">​</a></h3><pre><code>struct sockaddr_in addr; //强转实现 对应

addr.sin_family = AF_INET/AF_INET6				

addr.sin_port = htons(9527);
------------------------------------
	int dst;

	inet_pton(AF_INET, &quot;192.157.22.45&quot;, (void *)&amp;dst);

addr.sin_addr.s_addr = dst;  // 这三行 一般不这么用  下面那么用
----------------------------------------

【*】addr.sin_addr.s_addr = htonl(INADDR_ANY);		取出系统中有效的任意IP地址。二进制类型。
//INADDR_ANY 是自动取 系统中有效的 ip地址, 且是 二进制类型, 因此使用 htonl函数

bind(fd, (struct sockaddr *)&amp;addr, size);   // 强转实现 对应
</code></pre><h2 id="htonl%20%E5%92%8C%20inet_pton%E5%8C%BA%E5%88%AB" tabindex="-1">htonl 和 inet_pton区别 <a class="header-anchor" href="#htonl 和 inet_pton区别" aria-label="Permalink to &quot;htonl 和 inet_pton区别&quot;">​</a></h2><p><strong><code>htonl()</code></strong>：用于 <strong>整数数据</strong>的字节顺序转换，将主机字节序（例如，小端字节序）转换为网络字节序（大端字节序）。它通常用于处理 <strong>端口号</strong> 和 <strong>IP 地址</strong>（IPv4 地址）的 <strong>网络字节序表示</strong>。</p><p><strong><code>inet_pton()</code></strong>：将 <strong>点分十进制的 IP 地址</strong> 字符串转换为 <strong>网络字节序</strong> 的二进制地址形式，存储在 <code>struct in_addr</code> 或 <code>struct in6_addr</code> 中，适用于网络编程中处理 <strong>IP 地址</strong>。</p><h2 id="socket%E5%87%BD%E6%95%B0-%E5%88%9B%E5%BB%BA%E5%A5%97%E6%8E%A5%E5%AD%97%EF%BC%9A" tabindex="-1">socket函数-创建套接字： <a class="header-anchor" href="#socket函数-创建套接字：" aria-label="Permalink to &quot;socket函数-创建套接字：&quot;">​</a></h2><pre><code>#include &lt;sys/socket.h&gt;

int socket(int domain, int type, int protocol);		创建一个 套接字

	domain：AF_INET、AF_INET6、AF_UNIX(本地套接字) ip地址类型

	type：SOCK_STREAM、SOCK_DGRAM   数据传输协议 流式通信(代表:tcp) 和 数据报通信(代表:udp)。

	protocol: 0   表示 选用协议的 代表协议

	返回值：

		成功： 新套接字所对应文件描述符

		失败: -1 errno

fd = socket(AF_INET, SOCK_STREAM,0)
</code></pre><blockquote><p><strong>用途</strong>：初始化网络通信的入口，用于创建服务器或客户端的通信接口。</p></blockquote><h2 id="bind%E5%87%BD%E6%95%B0-%E7%BB%91%E5%AE%9A(ip%2B%E7%AB%AF%E5%8F%A3%E5%8F%B7)%E5%9C%B0%E5%9D%80%E7%BB%93%E6%9E%84" tabindex="-1">bind函数-绑定(ip+端口号)地址结构 <a class="header-anchor" href="#bind函数-绑定(ip%2B端口号)地址结构" aria-label="Permalink to &quot;bind函数-绑定(ip+端口号)地址结构&quot;">​</a></h2><blockquote><p>指定服务器监听的本地地址和端口号，使得客户端可以连接到服务器。</p></blockquote><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sockfd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> addrlen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);		给socket绑定一个 地址结构 (IP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">port)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	sockfd: socket 函数返回值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		addr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 与socket第一个参数一致</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		addr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8888</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INADDR_ANY);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	addr: 传入参数(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">addr</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 强转实现 对应., 新的此 addr 是 struvt sockaddr_in  ipv4 结构</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	addrlen: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(addr) 地址结构的大小。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	返回值：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		成功：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		失败：</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errno</span></span></code></pre></div><h2 id="listen%E5%87%BD%E6%95%B0%3A%20%E8%AE%BE%E7%BD%AE%E5%90%8C%E6%97%B6%E7%9B%91%E5%90%AC%E4%B8%AA%E6%95%B0" tabindex="-1">listen函数: 设置同时监听个数 <a class="header-anchor" href="#listen函数%3A 设置同时监听个数" aria-label="Permalink to &quot;listen函数: 设置同时监听个数&quot;">​</a></h2><blockquote><p><strong>用途</strong>：服务器进入监听状态，准备接收客户端连接。</p></blockquote><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sockfd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> backlog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);		设置同时与服务器建立连接的上限数。（同时进行3次握手的客户端数量）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	sockfd: socket 函数返回值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	backlog：上限数值。最大值 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        返回值：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		成功：</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		失败：</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errno</span></span></code></pre></div><h2 id="accept%E5%87%BD%E6%95%B0-%20%E9%98%BB%E5%A1%9E%E7%9B%91%E5%90%AC%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5" tabindex="-1">accept函数- 阻塞监听客户端连接 <a class="header-anchor" href="#accept函数- 阻塞监听客户端连接" aria-label="Permalink to &quot;accept函数\- 阻塞监听客户端连接&quot;">​</a></h2><ul><li><blockquote><p><strong>用途</strong>：服务器与客户端建立连接，进入通信状态。</p></blockquote></li></ul><p>​ ​ int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen); 阻塞等待客户端建立连接，成功的话，返回一个与客户端成功连接的socket文件描述符。 ​ ​ sockfd: socket 函数返回值 ​ ​ addr：传出参数。成功与服务器建立连接的那个客户端的地址结构（IP+port）------没有了 const</p><p>​ ​ ​ socklen_t clit_addr_len = sizeof(addr); ​ ​ addrlen：传入传出。 &amp;clit_addr_len ​ ​ 入：addr的大小。 出：客户端addr实际大小。 ​ 对于 struct sockaddr_in，通常返回值仍然是 sizeof(struct sockaddr_in)，但在某些协议扩展或特定情况下可能不同。 ​ 返回值：</p><pre><code>		成功：能与客户端进行数据通信的 socket 对应的文件描述。

		失败： -1 ， errno
</code></pre><h2 id="%E5%8C%BA%E5%88%AB%20bind%20%E5%92%8C%20accept%20%E7%9A%84%20addr%E5%8F%82%E6%95%B0" tabindex="-1">区别 bind 和 accept 的 addr参数 <a class="header-anchor" href="#区别 bind 和 accept 的 addr参数" aria-label="Permalink to &quot;区别 bind 和 accept 的 addr参数&quot;">​</a></h2><p>bind 里 是传入参数, 有 const 修饰</p><p>accept 里 是传出参数, 无 const修饰</p><p>bind里 addr 绑定的是 服务端自己的 地址结构</p><p>accept里 addr 绑定的是 客户端的 地址结构</p><h2 id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%80%E8%88%AC%E4%B8%8D%E9%9C%80%E8%A6%81%20bind" tabindex="-1">客户端一般不需要 bind <a class="header-anchor" href="#客户端一般不需要 bind" aria-label="Permalink to &quot;客户端一般不需要 bind&quot;">​</a></h2><p>在客户端,不使用, 将会是 隐式绑定</p><h2 id="connect%E5%87%BD%E6%95%B0%E2%80%8B-%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5" tabindex="-1">connect函数​-与服务器建立连接 <a class="header-anchor" href="#connect函数​-与服务器建立连接" aria-label="Permalink to &quot;connect函数​-与服务器建立连接&quot;">​</a></h2><pre><code> int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);	  使用现有的 socket 与服务器建立连接
​    
    	sockfd： socket 函数返回值
    		
		struct sockaddr_in srv_addr;		// 服务器地址结构

		srv_addr.sin_family = AF_INET;

		srv_addr.sin_port = 9527 	跟服务器bind时设定的 port 完全一致。

		inet_pton(AF_INET, &quot;服务器的IP地址&quot;，&amp;srv_adrr.sin_addr.s_addr);

	addr：传入参数。服务器的地址结构
				
​		addrlen：服务器的地址结构的大小
​	
		返回值：
				成功：0

		失败：-1 errno

	如果不使用bind绑定客户端地址结构, 采用&quot;隐式绑定&quot;.
</code></pre><blockquote><p>特别注意: addr的参数 有些 不能随便设置</p></blockquote><h2 id="%E5%A5%97%E6%8E%A5%E5%AD%97%E4%B8%AA%E6%95%B0--%E5%BE%88%E9%87%8D%E8%A6%81" tabindex="-1">套接字个数--很重要 <a class="header-anchor" href="#套接字个数--很重要" aria-label="Permalink to &quot;套接字个数--很重要&quot;">​</a></h2><blockquote><p>一个客户端, 一个服务端, 但是有 三个 套接字</p><p>一对 通信的</p><p>一个 服务端监听的</p></blockquote><p><strong>服务端监听套接字</strong>（<code>listening socket</code>）</p><ul><li>服务端通过 <code>socket()</code> 创建的套接字，用于监听客户端的连接请求。</li><li>这是一个 <strong>被动套接字</strong>，只负责接受连接请求，不直接用于数据通信。</li><li>在 <code>bind()</code> 后绑定到特定的 IP 和端口，通过 <code>listen()</code> 开始监听连接。</li></ul><p><strong>服务端通信套接字</strong>（<code>connected socket</code>）</p><ul><li>服务端通过 <code>accept()</code> 从监听套接字中获取的新套接字，用于与某个客户端进行通信。</li><li>每当一个客户端连接成功，服务端会创建一个新的通信套接字，与该客户端独立通信。</li></ul><p><strong>客户端套接字</strong>（<code>client socket</code>）</p><ul><li>客户端通过 <code>socket()</code> 创建的套接字，主动发起与服务端的连接请求。</li><li>这个套接字在 <code>connect()</code> 成功后，直接用于与服务端通信。</li></ul><blockquote><p>就比如, 酒店门口有一个 迎宾小姐, 把你领进房间, 房间有另一个人 接待你</p></blockquote><h2 id="TCP%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90%3A" tabindex="-1">TCP通信流程分析: <a class="header-anchor" href="#TCP通信流程分析%3A" aria-label="Permalink to &quot;TCP通信流程分析:&quot;">​</a></h2><pre><code>server:
	1. socket()	创建socket

	2. bind()	绑定服务器地址结构

	3. listen()	设置监听上限,  （同时进行3次握手的客户端数量）

	4. accept()	阻塞监听客户端连接

	5. read(fd)	读socket获取客户端数据

	6. 小--大写	toupper()

	7. write(fd)

	8. close();

client:

	1. socket()	创建socket

	2. connect();	与服务器建立连接  ip和端口号

	3. write()	写数据到 socket

	4. read()	读转换后的数据。

	5. 显示读取结果

	6. close()
</code></pre><h2 id="%E6%B5%81%E7%A8%8B%E5%9B%BE-%E9%87%8D%E4%B8%AD%E4%B9%8B%E9%87%8D" tabindex="-1">流程图-重中之重 <a class="header-anchor" href="#流程图-重中之重" aria-label="Permalink to &quot;流程图-重中之重&quot;">​</a></h2><p><img src="/mycppnoteweb/assets/client-server%E6%B5%81%E7%A8%8B%E5%9B%BE.ByeyKj9w.jpg" alt="img"></p><h2 id="%E8%A1%A5%E5%85%85-1%20socket%E5%AE%9E%E4%BE%8B-1%20server" tabindex="-1">补充-1 socket实例-1 server <a class="header-anchor" href="#补充-1 socket实例-1 server" aria-label="Permalink to &quot;补充-1 socket实例-1 server&quot;">​</a></h2><p>大小写转换</p><p>该server实例, 在没有客户端的情况下, 可以使用nc 命令, 进行通讯</p><p>一般不会自动退出 程序, 需手动停止, 或者 客户端发 终止信号</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;ctype.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;errno.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;pthread.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SERV_PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9527</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sys_err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    perror</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret, i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf[BUFSIZ], client_IP[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> serv_addr, clit_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // �����������ַ�ṹ �� �ͻ��˵�ַ�ṹ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    socklen_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clit_addr_len;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				  // �ͻ��˵�ַ�ṹ��С</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				// IPv4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SERV_PORT);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// תΪ�����ֽ���� �˿ں�</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INADDR_ANY);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// ��ȡ����������ЧIP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		//����һ�� socket</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (lfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sys_err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;socket error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//��������socket�󶨵�ַ�ṹ��IP+port)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">					//	���ü�������</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    clit_addr_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clit_addr);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 	��ȡ�ͻ��˵�ַ�ṹ��С</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clit_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clit_addr_len);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// �����ȴ��ͻ�����������</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sys_err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;accept error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;client ip:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            inet_ntop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clit_addr.sin_addr.s_addr, client_IP, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(client_IP)), </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            ntohs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clit_addr.sin_port));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// 可以拿到 客户端的ip和端口</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// ���ͻ�������</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STDOUT_FILENO, buf, ret);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">			// д����Ļ�鿴</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">				// Сд -- ��д</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            buf[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> toupper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf[i]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, buf, ret);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">					// ����д��д�ظ��ͻ��ˡ�</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="%E8%A1%A5%E5%85%85-2%20client" tabindex="-1">补充-2 client <a class="header-anchor" href="#补充-2 client" aria-label="Permalink to &quot;补充-2 client&quot;">​</a></h2><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;errno.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;pthread.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SERV_PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9527</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sys_err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	perror</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cfd;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf[BUFSIZ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> serv_addr;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          //服务器地址结构</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SERV_PORT);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //inet_pton(AF_INET, &quot;127.0.0.1&quot;, &amp;serv_addr.sin_addr.s_addr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    inet_pton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr.sin_addr);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sys_err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;socket error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sys_err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connect err&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (conter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STDOUT_FILENO, buf, ret);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B3%A8%E6%84%8F%E7%82%B9%3A" tabindex="-1">客户端注意点: <a class="header-anchor" href="#客户端注意点%3A" aria-label="Permalink to &quot;客户端注意点:&quot;">​</a></h2><p>客户端不需要 设置客户端的 地址结构, 也就是 bind函数, 会隐式确定</p><p>connect函数, 里面是 服务端的 ip和port</p><h2 id="nc%E5%91%BD%E4%BB%A4" tabindex="-1">nc命令 <a class="header-anchor" href="#nc命令" aria-label="Permalink to &quot;nc命令&quot;">​</a></h2><p><code>nc</code>（全称为 <strong>Netcat</strong>）是一款功能强大的网络工具，用于调试和网络通信。它支持 TCP 和 UDP 协议，能够作为客户端或服务器工作。</p><h3 id="%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD" tabindex="-1"><strong>基本功能</strong> <a class="header-anchor" href="#基本功能" aria-label="Permalink to &quot;**基本功能**&quot;">​</a></h3><ol><li><strong>监听端口</strong>：作为服务端接收连接。</li><li><strong>发起连接</strong>：作为客户端连接到目标主机和端口。</li><li><strong>数据传输</strong>：发送或接收数据流。</li><li><strong>端口扫描</strong>：扫描目标主机的开放端口。</li><li><strong>文件传输</strong>：通过网络传递文件。</li></ol><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nc [选项] [目标地址] [端口]</span></span></code></pre></div><h3 id="%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95" tabindex="-1"><strong>常见用法</strong> <a class="header-anchor" href="#常见用法" aria-label="Permalink to &quot;**常见用法**&quot;">​</a></h3><h4 id="1.%20%E7%AE%80%E5%8D%95%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3" tabindex="-1"><strong>1. 简单监听端口</strong> <a class="header-anchor" href="#1. 简单监听端口" aria-label="Permalink to &quot;**1. 简单监听端口**&quot;">​</a></h4><p>在本地端口 <code>1234</code> 上监听，等待连接：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nc -l -p 1234</span></span></code></pre></div><h4 id="2.%20%E5%8F%91%E8%B5%B7%20TCP%20%E8%BF%9E%E6%8E%A5" tabindex="-1"><strong>2. 发起 TCP 连接</strong> <a class="header-anchor" href="#2. 发起 TCP 连接" aria-label="Permalink to &quot;**2. 发起 TCP 连接**&quot;">​</a></h4><p>连接到 <code>192.168.1.100</code> 的 <code>80</code> 端口：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nc 192.168.1.100 80</span></span></code></pre></div><h4 id="3.%20%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93" tabindex="-1"><strong>3. 文件传输</strong> <a class="header-anchor" href="#3. 文件传输" aria-label="Permalink to &quot;**3. 文件传输**&quot;">​</a></h4><p><strong>服务端</strong>监听并接收文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nc -l -p 1234 &gt; received_file.txt</span></span></code></pre></div><p><strong>客户端</strong>发送文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nc 192.168.1.100 1234 &lt; file_to_send.txt</span></span></code></pre></div><h4 id="4.%20%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F" tabindex="-1"><strong>4. 端口扫描</strong> <a class="header-anchor" href="#4. 端口扫描" aria-label="Permalink to &quot;**4. 端口扫描**&quot;">​</a></h4><p>扫描目标主机的指定端口范围（如 1-1000）：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nc -z -v 192.168.1.100 1-1000</span></span></code></pre></div><h4 id="5.%20%E6%B5%8B%E8%AF%95%20UDP%20%E8%BF%9E%E6%8E%A5" tabindex="-1"><strong>5. 测试 UDP 连接</strong> <a class="header-anchor" href="#5. 测试 UDP 连接" aria-label="Permalink to &quot;**5. 测试 UDP 连接**&quot;">​</a></h4><p>服务端监听 UDP 端口：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>nc -u -l -p</span></span></code></pre></div><h2 id="%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%20%E5%B8%B8%E7%94%A8%E5%A4%B4%E6%96%87%E4%BB%B6" tabindex="-1">网络编程 常用头文件 <a class="header-anchor" href="#网络编程 常用头文件" aria-label="Permalink to &quot;网络编程 常用头文件&quot;">​</a></h2><p><strong><code>&lt;sys/socket.h&gt;</code></strong>：定义套接字函数和相关常量。</p><p><strong><code>&lt;netinet/in.h&gt;</code></strong>：定义网络地址结构和协议。</p><p><strong><code>&lt;arpa/inet.h&gt;</code></strong>：提供 IP 地址转换的工具函数。</p><p><strong><code>&lt;unistd.h&gt;</code></strong>：定义 <code>close</code> 等函数。</p><p><strong><code>&lt;string.h&gt;</code></strong>：处理字符串和内存操作。</p><p><strong><code>&lt;errno.h&gt;</code></strong>：提供错误码。</p><h1 id="day12" tabindex="-1">day12 <a class="header-anchor" href="#day12" aria-label="Permalink to &quot;day12&quot;">​</a></h1><h2 id="%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B(tcp)%EF%BC%9A" tabindex="-1">三次握手(tcp)： <a class="header-anchor" href="#三次握手(tcp)：" aria-label="Permalink to &quot;三次握手(tcp)：&quot;">​</a></h2><pre><code>主动发起连接请求端，发送 SYN 标志位，请求建立连接。 携带序号号、数据字节数(0)、滑动窗口大小。

被动接受连接请求端，发送 ACK 标志位，同时携带 SYN 请求标志位。携带序号、确认序号、数据字节数(0)、滑动窗口大小。

主动发起连接请求端，发送 ACK 标志位，应答服务器连接请求。携带确认序号。
</code></pre><p>这个连接请求端, 好像表达的有问题</p><h2 id="%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B(tcp)%EF%BC%9A%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5" tabindex="-1">四次挥手(tcp)：关闭连接 <a class="header-anchor" href="#四次挥手(tcp)：关闭连接" aria-label="Permalink to &quot;四次挥手(tcp)：关闭连接&quot;">​</a></h2><pre><code>主动关闭连接请求端， 发送 FIN 标志位。 

被动关闭连接请求端， 应答 ACK 标志位。 		 ----- 半关闭完成。
</code></pre><blockquote><p>关的是 缓冲区, 而不是整个 套接字</p></blockquote><pre><code>被动关闭连接请求端， 发送 FIN 标志位。

主动关闭连接请求端， 应答 ACK 标志位。		 ----- 连接全部关闭
</code></pre><h2 id="%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%EF%BC%9A" tabindex="-1">滑动窗口： <a class="header-anchor" href="#滑动窗口：" aria-label="Permalink to &quot;滑动窗口：&quot;">​</a></h2><pre><code>发送给连接对端，本端的缓冲区大小（实时），保证数据不会丢失。
</code></pre><hr><p>回看 socket里面的 c/s tcp模型图, 对应这个 三次握手, 四次挥手(课件)</p><h1 id="socket-2" tabindex="-1">socket-2 <a class="header-anchor" href="#socket-2" aria-label="Permalink to &quot;socket-2&quot;">​</a></h1><h2 id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0(%E8%87%AA%E5%B7%B1%E5%B0%81%E8%A3%85%E5%87%BD%E6%95%B0)%EF%BC%9A" tabindex="-1">错误处理函数(自己封装函数)： <a class="header-anchor" href="#错误处理函数(自己封装函数)：" aria-label="Permalink to &quot;错误处理函数(自己封装函数)：&quot;">​</a></h2><pre><code>封装目的： 

	在 server.c 编程过程中突出逻辑，将出错处理与逻辑分开，可以直接跳转man手册。


【wrap.c】								【wrap.h】


存放网络通信相关常用 自定义函数						存放 网络通信相关常用 自定义函数原型(声明)。

命名方式：系统调用函数首字符大写, 方便查看man手册
	
	  如：Listen()、Accept();

函数功能：调用系统调用函数，处理出错场景。

在 server.c 和 client.c 中调用 自定义函数

联合编译 server.c 和 wrap.c 生成 server
 
	 client.c 和 wrap.c 生成 client
</code></pre><h2 id="%E8%A1%A5%E5%85%85-1%20%E5%B0%81%E8%A3%85%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0" tabindex="-1">补充-1 封装错误处理函数 <a class="header-anchor" href="#补充-1 封装错误处理函数" aria-label="Permalink to &quot;补充-1 封装错误处理函数&quot;">​</a></h2><p>对于 函数名, 如果 大写, 仍然可以跳转man手册</p><p>因此, 使用大写 封装 原函数的 错误处理信息</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// wrap.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __WRAP_H_</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> __WRAP_H_</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">salenptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> salen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> salen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> backlog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> family</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> nbytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> nbytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Readn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Writen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Readline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> maxlen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span></span></code></pre></div><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// wrap.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;errno.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	perror</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">salenptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, sa, salenptr)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ECONNABORTED) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EINTR))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			goto</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		else</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;accept error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> salen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, sa, salen)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bind error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">socklen_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> salen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, sa, salen)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;connect error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> backlog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, backlog)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;listen error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> family</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(family, type, protocol)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;socket error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> nbytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	ssize_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, ptr, nbytes)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EINTR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			goto</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> nbytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	ssize_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, ptr, nbytes)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EINTR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			goto</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;close error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*参三: 应该读取的字节数*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Readn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  nleft;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              //usigned int 剩余未读取的字节数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	ssize_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nread;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              //int 实际读到的字节数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vptr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	nleft </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nleft </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((nread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, ptr, nleft)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EINTR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				nread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">				return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		nleft </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nleft;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Writen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nleft;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	ssize_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nwritten;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vptr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	nleft </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nleft </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( (nwritten </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, ptr, nleft)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nwritten </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EINTR)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				nwritten </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">				return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		nleft </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nwritten;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nwritten;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read_cnt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">read_ptr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read_buf[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (read_cnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( (read_cnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, read_buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(read_buf))) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (errno </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EINTR)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">				goto</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> again</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (read_cnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		read_ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read_buf;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	read_cnt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">read_ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssize_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Readline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> maxlen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	ssize_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n, rc;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    c, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vptr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxlen; n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ( (rc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> my_read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">				break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ptr  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><blockquote><p>通过封装,降低 主函数的 长度, 强化处理逻辑</p></blockquote><h2 id="read%E5%92%8Cwrite%E5%B1%80%E9%99%90" tabindex="-1">read和write局限 <a class="header-anchor" href="#read和write局限" aria-label="Permalink to &quot;read和write局限&quot;">​</a></h2><p>在系统中, 用系统调用</p><p>不在系统中时, 多用库函数, 提高效率, 自己封装read 会有点麻烦</p><p>但是</p><p>在 sockrt里, 不能用 库函数 fread, fwrite, 因为需要 文件结构体指针</p><p>但 socket里 只有文件描述符</p><h2 id="readn%20%E8%87%AA%E5%B0%81%E8%A3%85(%E8%A7%81%E8%AF%BE%E7%A8%8B)%EF%BC%9A" tabindex="-1">readn 自封装(见课程)： <a class="header-anchor" href="#readn 自封装(见课程)：" aria-label="Permalink to &quot;readn 自封装(见课程)：&quot;">​</a></h2><p><img src="/mycppnoteweb/assets/readn.HJXouHNM.png" alt="image-20250123173040214"></p><p>​ 读 N 个字节</p><h2 id="readline%EF%BC%9A" tabindex="-1">readline： <a class="header-anchor" href="#readline：" aria-label="Permalink to &quot;readline：&quot;">​</a></h2><pre><code>读一行
</code></pre><h2 id="read%20%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC(%E9%87%8D%E7%82%B9)%EF%BC%9A" tabindex="-1">read 函数的返回值(重点)： <a class="header-anchor" href="#read 函数的返回值(重点)：" aria-label="Permalink to &quot;read 函数的返回值(重点)：&quot;">​</a></h2><pre><code>1. &gt; 0 实际读到的字节数

2. = 0 已经读到结尾（对端已经关闭）【 ！重 ！点 ！】

3. -1 应进一步判断errno的值：

	errno = EAGAIN or EWOULDBLOCK: 设置了非阻塞方式 读。 没有数据到达。 

	errno = EINTR 慢速系统调用被 中断。

	errno = “其他情况” 异常。
</code></pre><blockquote><p>网络编程中, read返回0 非常重要</p><p>= 0 已经读到结尾（对端已经关闭）</p></blockquote><h2 id="%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9Aserver.c" tabindex="-1">多进程并发服务器：server.c <a class="header-anchor" href="#多进程并发服务器：server.c" aria-label="Permalink to &quot;多进程并发服务器：server.c&quot;">​</a></h2><p>只用子进程 处理, 父进程 持续监听, 因此 每个子进程 开始时, 必须关闭 最初的 服务器第一个 套接字</p><pre><code>1. Socket();		创建 监听套接字 lfd
2. Bind()	绑定地址结构 Strcut scokaddr_in addr;
3. Listen();	
4. while (1) {

	cfd = Accpet();			接收客户端连接请求。
	pid = fork();
	if (pid == 0){			子进程 read(cfd) --- 小-》大 --- write(cfd)

		close(lfd)		关闭用于建立连接的套接字 lfd

		read()
		小--大
		write()

	} else if （pid &gt; 0） {	

		close(cfd);		关闭用于与客户端通信的套接字 cfd	
		contiue;
	}
  }

5. 子进程：

	close(lfd)

	read()

	小--大

	write()	

   父进程：

	close(cfd);

	注册信号捕捉函数：	SIGCHLD

	在回调函数中， 完成子进程回收

		while （waitpid()）;
</code></pre><h2 id="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A%20server.c" tabindex="-1">多线程并发服务器： server.c <a class="header-anchor" href="#多线程并发服务器： server.c" aria-label="Permalink to &quot;多线程并发服务器： server.c&quot;">​</a></h2><pre><code>1. Socket();		创建 监听套接字 lfd

2. Bind()		绑定地址结构 Strcut scokaddr_in addr;

3. Listen();		

4. while (1) {		

	cfd = Accept(lfd, );

	pthread_create(&amp;tid, NULL, tfn, (void *)cfd);

	pthread_detach(tid);  				// pthead_join(tid, void **);  新线程---专用于回收子线程。    
  }

5. 子线程：

	void *tfn(void *arg) 
	{
		// close(lfd)			不能关闭。 主线程要使用lfd  线程共享 fd

		read(cfd)

		小--大

		write(cfd)

		pthread_exit（(void *)10）;	
	}
</code></pre><blockquote><p>兄弟线程之间可以回收 pthread_join</p><p>兄弟进程 不能, 所以才有了 信号捕捉 SIGCHLD 处理子进程退出</p></blockquote><h2 id="%E8%A1%A5%E5%85%85-1%20%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%20%E5%AE%9E%E4%BE%8B" tabindex="-1">补充-1 多进程并发服务器 实例 <a class="header-anchor" href="#补充-1 多进程并发服务器 实例" aria-label="Permalink to &quot;补充-1 多进程并发服务器 实例&quot;">​</a></h2><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;ctype.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/wait.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;strings.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;errno.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;signal.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;sys/socket.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;pthread.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;wrap.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SRV_PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 9999</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> catch_child</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> signum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">waitpid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, WNOHANG)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lfd, cfd;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pid_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pid;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> srv_addr, clt_addr;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    socklen_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clt_addr_len; </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf[BUFSIZ];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret, i;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //memset(&amp;srv_addr, 0, sizeof(srv_addr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 // 将地址结构清零</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bzero</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">srv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(srv_addr));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    srv_addr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    srv_addr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SRV_PORT);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    srv_addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INADDR_ANY);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">srv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(srv_addr));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    clt_addr_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clt_addr);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clt_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clt_addr_len);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fork error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lfd);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sigaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> act;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            act.sa_handler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> catch_child;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            sigemptyset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">act.sa_mask);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            act.sa_flags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sigaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SIGCHLD, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">act, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">               perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sigaction error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd); </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pid </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;;) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                buf[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> toupper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf[i]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfd, buf, ret);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STDOUT_FILENO, buf, ret);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="memset%E5%87%BD%E6%95%B0%E5%92%8Cbzero%E5%87%BD%E6%95%B0" tabindex="-1">memset函数和bzero函数 <a class="header-anchor" href="#memset函数和bzero函数" aria-label="Permalink to &quot;memset函数和bzero函数&quot;">​</a></h2><h3 id="memset%20%E5%87%BD%E6%95%B0" tabindex="-1"><strong><code>memset</code> 函数</strong> <a class="header-anchor" href="#memset 函数" aria-label="Permalink to &quot;**`memset` 函数**&quot;">​</a></h3><p><code>memset</code> 是一个标准的 C 库函数，用于将某个值填充到一块内存区域中。</p><h4 id="%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B" tabindex="-1"><strong>函数原型</strong> <a class="header-anchor" href="#函数原型" aria-label="Permalink to &quot;**函数原型**&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>void *memset(void *s, int c, size_t n);</span></span></code></pre></div><h4 id="%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" tabindex="-1"><strong>参数说明</strong> <a class="header-anchor" href="#参数说明" aria-label="Permalink to &quot;**参数说明**&quot;">​</a></h4><ul><li><code>s</code>：指向需要初始化的内存区域的指针。</li><li><code>c</code>：要填充的值（会被转换为无符号字符类型，即 <code>unsigned char</code>）。</li><li><code>n</code>：需要填充的字节数。</li></ul><h4 id="%E5%8A%9F%E8%83%BD" tabindex="-1"><strong>功能</strong> <a class="header-anchor" href="#功能" aria-label="Permalink to &quot;**功能**&quot;">​</a></h4><p>将内存区域的前 <code>n</code> 个字节设置为值 <code>c</code>。</p><h3 id="bzero%20%E5%87%BD%E6%95%B0" tabindex="-1"><strong><code>bzero</code> 函数</strong> <a class="header-anchor" href="#bzero 函数" aria-label="Permalink to &quot;**`bzero` 函数**&quot;">​</a></h3><p><code>bzero</code> 是一个非标准函数，主要用于将一块内存清零。</p><h4 id="%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B-1" tabindex="-1"><strong>函数原型</strong> <a class="header-anchor" href="#函数原型-1" aria-label="Permalink to &quot;**函数原型**&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>void bzero(void *s, size_t n);</span></span></code></pre></div><h4 id="%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-1" tabindex="-1"><strong>参数说明</strong> <a class="header-anchor" href="#参数说明-1" aria-label="Permalink to &quot;**参数说明**&quot;">​</a></h4><ul><li><code>s</code>：指向需要清零的内存区域的指针。</li><li><code>n</code>：需要清零的字节数。</li></ul><h4 id="%E5%8A%9F%E8%83%BD-1" tabindex="-1"><strong>功能</strong> <a class="header-anchor" href="#功能-1" aria-label="Permalink to &quot;**功能**&quot;">​</a></h4><p>将内存区域的前 <code>n</code> 个字节设置为 0。</p><p>在现代 C 编程中，优先使用 <code>memset</code> 替代 <code>bzero</code>，因为：</p><ul><li><code>memset</code> 是标准库函数，具有更好的兼容性和移植性。</li><li><code>bzero</code> 在一些新的系统（如 Linux 的 glibc）中已经被标记为过时，可能会引发警告。</li></ul><h2 id="wait%E5%87%BD%E6%95%B0%20%E5%92%8C%20%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89%E5%AE%9E%E7%8E%B0%20%E5%9B%9E%E6%94%B6%E8%BF%9B%E7%A8%8B%E5%8C%BA%E5%88%AB" tabindex="-1">wait函数 和 信号捕捉实现 回收进程区别 <a class="header-anchor" href="#wait函数 和 信号捕捉实现 回收进程区别" aria-label="Permalink to &quot;wait函数 和 信号捕捉实现 回收进程区别&quot;">​</a></h2><h3 id="wait%20%E7%B3%BB%E5%88%97%E5%87%BD%E6%95%B0" tabindex="-1"><strong><code>wait</code> 系列函数</strong> <a class="header-anchor" href="#wait 系列函数" aria-label="Permalink to &quot;**`wait` 系列函数**&quot;">​</a></h3><p><code>wait</code> 和 <code>waitpid</code> 是最直接的方式，用于等待子进程退出并回收其资源。</p><h4 id="%E5%85%B3%E9%94%AE%E7%82%B9" tabindex="-1"><strong>关键点</strong> <a class="header-anchor" href="#关键点" aria-label="Permalink to &quot;**关键点**&quot;">​</a></h4><ul><li><strong><code>wait</code></strong>：阻塞当前进程，直到任意子进程退出。</li><li><strong><code>waitpid</code></strong>：可以等待指定的子进程，支持非阻塞模式。</li></ul><h4 id="%E4%BC%98%E7%82%B9" tabindex="-1"><strong>优点</strong> <a class="header-anchor" href="#优点" aria-label="Permalink to &quot;**优点**&quot;">​</a></h4><ul><li>精确控制：父进程明确等待某个或任意子进程，控制逻辑清晰。</li><li>支持非阻塞：通过 <code>waitpid</code> 的 <code>WNOHANG</code> 选项，可以轮询子进程状态。</li></ul><h4 id="%E7%BC%BA%E7%82%B9" tabindex="-1"><strong>缺点</strong> <a class="header-anchor" href="#缺点" aria-label="Permalink to &quot;**缺点**&quot;">​</a></h4><ul><li>阻塞问题：<code>wait</code> 会阻塞父进程，如果没有子进程退出，父进程会一直等待。</li><li>繁琐：需要显式调用 <code>wait</code> 或 <code>waitpid</code>，父进程需要主动管理子进程。</li></ul><h3 id="%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89%20(SIGCHLD)" tabindex="-1"><strong>信号捕捉 (<code>SIGCHLD</code>)</strong> <a class="header-anchor" href="#信号捕捉 (SIGCHLD)" aria-label="Permalink to &quot;**信号捕捉 (`SIGCHLD`)**&quot;">​</a></h3><p>信号捕捉是通过处理 <code>SIGCHLD</code> 信号，在子进程退出时自动触发信号处理函数，用于回收子进程资源。</p><h4 id="%E5%85%B3%E9%94%AE%E7%82%B9-1" tabindex="-1"><strong>关键点</strong> <a class="header-anchor" href="#关键点-1" aria-label="Permalink to &quot;**关键点**&quot;">​</a></h4><ul><li>当子进程退出时，内核会向父进程发送 <code>SIGCHLD</code> 信号。</li><li>父进程可以在信号处理函数中调用 <code>waitpid</code> 来回收子进程。</li></ul><h4 id="%E4%BC%98%E7%82%B9-1" tabindex="-1"><strong>优点</strong> <a class="header-anchor" href="#优点-1" aria-label="Permalink to &quot;**优点**&quot;">​</a></h4><ul><li>非阻塞：信号处理是异步的，不会阻塞父进程。</li><li>自动化：无需主动轮询，内核会在子进程退出时通知父进程。</li></ul><h4 id="%E7%BC%BA%E7%82%B9-1" tabindex="-1"><strong>缺点</strong> <a class="header-anchor" href="#缺点-1" aria-label="Permalink to &quot;**缺点**&quot;">​</a></h4><ul><li>信号竞争问题：如果在信号处理期间有多个子进程退出，可能需要额外的逻辑处理。</li><li>复杂度稍高：需要正确设置信号处理函数，处理好信号和主程序的逻辑。</li></ul><h2 id="%E8%A1%A5%E5%85%85-2%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8" tabindex="-1">补充-2 多线程并发服务器 <a class="header-anchor" href="#补充-2 多线程并发服务器" aria-label="Permalink to &quot;补充-2 多线程并发服务器&quot;">​</a></h2><p>多线程 需要数组 存线程id</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;pthread.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;ctype.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;fcntl.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;wrap.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MAXLINE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8192</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SERV_PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> s_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                     //定义一个结构体, 将地址结构跟cfd捆绑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cliaddr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connfd;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n,i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> s_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> s_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)arg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf[MAXLINE];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> str[INET_ADDRSTRLEN];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      //#define INET_ADDRSTRLEN 16  可用&quot;[+d&quot;查看</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ts-&gt;connfd, buf, MAXLINE);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                     //读客户端</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;the client </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> closed...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ts-&gt;connfd);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                              //跳出循环,关闭cfd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;received from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at PORT </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                inet_ntop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ts).cliaddr.sin_addr, str, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str)),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                ntohs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ts).cliaddr.sin_port));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 //打印客户端信息(IP/PORT)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            buf[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> toupper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf[i]);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                           //小写--&gt;大写</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STDOUT_FILENO, buf, n);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                           //写出至屏幕</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ts-&gt;connfd, buf, n);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                              //回写给客户端</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ts-&gt;connfd);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> servaddr, cliaddr;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    socklen_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cliaddr_len;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listenfd, connfd;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    pthread_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> s_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ts[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      //创建结构体数组.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    listenfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                     //创建一个socket, 得到lfd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bzero</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">servaddr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(servaddr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                             //地址结构清零</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    servaddr.sin_family </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    servaddr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INADDR_ANY);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                               //指定本地任意IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    servaddr.sin_port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SERV_PORT);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                       //指定端口号 </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">servaddr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(servaddr));</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             //绑定</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                                      //设置同一时刻链接服务器上限数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Accepting client connect ...</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cliaddr_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cliaddr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        connfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cliaddr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cliaddr_len);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   //阻塞监听客户端链接请求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ts[i].cliaddr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cliaddr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ts[i].connfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connfd;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        pthread_create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tid, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, do_work, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ts[i]);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //这里传值,会丢数据, 数组中一个结构体大小 20字节, void* 是4字节 强转 会丢数据   而数组没法变化,正好可以传地址</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 可以malloc 空间, 把这个空间地址 传过去, </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        pthread_detach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tid);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                                    //子线程分离,防止僵线程产生.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>32位系统：</strong> void* 通常占用4个字节。</p><p><strong>64位系统：</strong> void* 通常占用8个字节。</p><hr><h1 id="day13" tabindex="-1">day13 <a class="header-anchor" href="#day13" aria-label="Permalink to &quot;day13&quot;">​</a></h1><h2 id="TCP%E7%8A%B6%E6%80%81%E6%97%B6%E5%BA%8F%E5%9B%BE%EF%BC%9A" tabindex="-1">TCP状态时序图： <a class="header-anchor" href="#TCP状态时序图：" aria-label="Permalink to &quot;TCP状态时序图：&quot;">​</a></h2><blockquote><p>重点是 课件的 图</p></blockquote><p><img src="/mycppnoteweb/assets/TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE.D7ZWzYN5.png" alt="image-20250124114722452"></p><pre><code>结合三次握手、四次挥手 理解记忆。


1. 主动发起连接请求端：	CLOSE -- 发送SYN -- SEND_SYN -- 接收 ACK、SYN -- SEND_SYN -- 发送 ACK -- ESTABLISHED（数据通信态）

2. 主动关闭连接请求端： ESTABLISHED（数据通信态） -- 发送 FIN -- FIN_WAIT_1 -- 接收ACK -- FIN_WAIT_2（半关闭）

			-- 接收对端发送 FIN -- FIN_WAIT_2（半关闭）-- 回发ACK -- TIME_WAIT（只有主动关闭连接方，会经历该状态）

			-- 等 2MSL时长 -- CLOSE 

3. 被动接收连接请求端： CLOSE -- LISTEN -- 接收 SYN -- LISTEN -- 发送 ACK、SYN -- SYN_RCVD -- 接收ACK -- ESTABLISHED（数据通信态）

4. 被动关闭连接请求端： ESTABLISHED（数据通信态） -- 接收 FIN -- ESTABLISHED（数据通信态） -- 发送ACK 

			-- CLOSE_WAIT (说明对端【主动关闭连接端】处于半关闭状态) -- 发送FIN -- LAST_ACK -- 接收ACK -- CLOSE


重点记忆： ESTABLISHED、FIN_WAIT_2 &lt;--&gt; CLOSE_WAIT、TIME_WAIT（2MSL）

netstat -apn | grep  端口号
</code></pre><blockquote><p>TIME_WAIT只有主动关闭端有这个状态</p><p>如果先关闭 服务端, 服务端是 FIN_WAIT_2 状态 客户端是CLOSE_WAIT</p><p>课件上的 实线和虚线 两个图</p></blockquote><blockquote><p>注意 上面的总结, 一直写的是 主动和被动, 没有对应到 服务端,客户端, 这个要注意, 具体情况具体分析你</p></blockquote><h2 id="netstat" tabindex="-1">netstat <a class="header-anchor" href="#netstat" aria-label="Permalink to &quot;netstat&quot;">​</a></h2><p><code>netstat</code> 是一个命令行工具，用于显示网络连接、路由表、网络接口统计信息等。它是诊断网络问题和监控网络活动的常用工具。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>netstat -a</span></span></code></pre></div><ul><li>显示所有活动的 TCP 和 UDP 连接以及监听端口。</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>netstat -ap</span></span></code></pre></div><ul><li>显示与端口或连接关联的程序名和 PID。</li></ul><p><strong>结合 grep 查找指定端口或服务</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>netstat -an | grep &lt;端口号&gt; 或者 &lt;服务程序&gt;</span></span></code></pre></div><ul><li><p>例如，查找 80 端口相关连接：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>bash</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>复制编辑</span></span>
<span class="line"><span>netstat -an | grep :80</span></span></code></pre></div></li></ul><p>在某些现代 Linux 发行版中，<code>netstat</code> 已被标记为过时，建议使用 <code>ss</code> 命令替代。<code>ss</code> 提供类似功能，但效率更高。</p><h3 id="%E4%BD%BF%E7%94%A8" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to &quot;使用&quot;">​</a></h3><p><code>-a</code>：显示所有连接和监听端口，包括 TCP 和 UDP。</p><p><code>-p</code>：显示与每个连接或端口关联的程序名及其 PID（需要管理员权限）。</p><p><code>-n</code>：以数字形式显示地址和端口，而不是解析主机名或服务名称（提高显示速度）。</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">netstat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">apn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grep client</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tcp        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">35268</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">         127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          ESTABLISHED </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1734</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client</span></span></code></pre></div><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">netstat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">apn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grep </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tcp        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 0.0.0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">            0.0.0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               LISTEN      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1553</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tcp        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">          127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">35268</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         ESTABLISHED </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1553</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server       </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tcp        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      0</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">35268</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">         127.0.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          ESTABLISHED </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1734</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client</span></span></code></pre></div><h2 id="2MSL%E6%97%B6%E9%95%BF%EF%BC%9A" tabindex="-1">2MSL时长： <a class="header-anchor" href="#2MSL时长：" aria-label="Permalink to &quot;2MSL时长：&quot;">​</a></h2><blockquote><p>等待 如果被动关闭端没收到最后的ACK,一定会 反复发送 FIN, 因此这个 等待 2MSL 是必须的</p></blockquote><pre><code>一定出现在【主动关闭连接请求端】。 --- 对应 TIME_WAIT 状态。

保证，最后一个 ACK 能成功被对端接收。（等待期间，对端没收到我发的ACK，对端会再次发送FIN请求。）
</code></pre><h2 id="%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8%3A" tabindex="-1">端口复用: <a class="header-anchor" href="#端口复用%3A" aria-label="Permalink to &quot;端口复用:&quot;">​</a></h2><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">服务器先关闭, 会有 TIME_WAIT状态, 导致 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MSL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">时长, 再次马上开启 是不行的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    所以有了 端口复用</span></span></code></pre></div><p>man手册无, 不全, 还得再书上找</p><p>这段代码 是死的, 复制即用 bind之前</p><p>opt 非0 表示开启, 0表示关闭</p><pre><code>int opt = 1;		// 设置端口复用。

setsockopt(lfd, SOL_SOCKET, SO_REUSEADDR, (void *)&amp;opt, sizeof(opt));
// 加peror检查
set---sock---opt
</code></pre><p>TIME_WAIT仍然在,但能用</p><h2 id="%E5%8D%8A%E5%85%B3%E9%97%AD%EF%BC%9A" tabindex="-1">半关闭： <a class="header-anchor" href="#半关闭：" aria-label="Permalink to &quot;半关闭：&quot;">​</a></h2><pre><code>通信双方中，只有一端关闭通信。  --- FIN_WAIT_2

close（cfd）;

shutdown(int fd, int how);	// 特殊关闭,只关一端

	how: 	SHUT_RD	关读端

		SHUT_WR	关写端

		SHUT_RDWR 关读写

shutdown在关闭多个文件描述符应用的文件时，采用全关闭方法。close，只关闭一个。
</code></pre><blockquote><p>在 dup2(3,4) close(3) 但4还能访问, shutdowmn(3) 将3和4都会关闭</p></blockquote><p>​</p><h2 id="select%E5%A4%9A%E8%B7%AFIO%E8%BD%AC%E6%8E%A5(selcet%2C%20poll%2C%20epoll)%EF%BC%9A" tabindex="-1">select多路IO转接(selcet, poll, epoll)： <a class="header-anchor" href="#select多路IO转接(selcet%2C poll%2C epoll)：" aria-label="Permalink to &quot;select多路IO转接(selcet, poll, epoll)：&quot;">​</a></h2><blockquote><p>阻塞:</p><p>非阻塞忙轮询:</p><p>响应式: 多路io转接</p></blockquote><h2 id="select" tabindex="-1">select <a class="header-anchor" href="#select" aria-label="Permalink to &quot;select&quot;">​</a></h2><pre><code>int select(int nfds, fd_set *readfds, fd_set *writefds,fd_set *exceptfds, struct timeval *timeout);

nfds：监听的所有文件描述符中，最大文件描述符+1  这个+1是man规定的, 但是写程序循环的时候, &lt; +1 或者 &lt;= 不+1  ,  他实际就是这个意思

readfds： 读事件    文件描述符监听集合。	传入、传出参数

writefds：写事件    文件描述符监听集合。	传入、传出参数		NULL

exceptfds：异常事件   文件描述符监听集合	传入、传出参数		NULL

timeout： 	&gt; 0: 	设置监听超时时长。

		NULL:	阻塞监听

		0：	非阻塞监听，轮询
返回值：

	&gt; 0:	所有监听集合（3个）中， 满足对应事件的总数。

	0：	没有满足监听条件的文件描述符

	-1： 	errno
</code></pre><p>​ 传入传出参数: 该函数 传进去的是要监听的, 传出来的 是 监听到发生事件的</p><blockquote><p>集合使用位图, 因此有select 相关的 下列函数也要 注意</p></blockquote><pre><code>原理：  借助内核， select 来监听， 客户端连接、数据通信事件。

void FD_ZERO(fd_set *set);	--- 清空一个文件描述符集合。  位图置0

	fd_set rset;

	FD_ZERO(&amp;rset);

void FD_SET(int fd, fd_set *set);	--- 将待监听的文件描述符，添加到监听集合中

	FD_SET(3, &amp;rset);	FD_SET(5, &amp;rset);	FD_SET(6, &amp;rset);


void FD_CLR(int fd, fd_set *set);	--- 将一个文件描述符从监听集合中 移除。

	FD_CLR（4， &amp;rset）;

int  FD_ISSET(int fd, fd_set *set);	--- 判断一个文件描述符是否在监听集合中。

	返回值： 在：1；不在：0；

	FD_ISSET（4， &amp;rset）;
</code></pre><h2 id="select%E6%80%9D%E8%B7%AF%E5%88%86%E6%9E%90%EF%BC%9A" tabindex="-1">select思路分析： <a class="header-anchor" href="#select思路分析：" aria-label="Permalink to &quot;select思路分析：&quot;">​</a></h2><pre><code>int maxfd = 0；

lfd = socket() ;			创建套接字

maxfd = lfd；

bind();					绑定地址结构

listen();				设置监听上限

fd_set rset， allset;			创建r监听集合

FD_ZERO(&amp;allset);				将r监听集合清空

FD_SET(lfd, &amp;allset);			将 lfd 添加至读集合中。

while（1） {

	rset = allset；			保存监听集合

	ret  = select(lfd+1， &amp;rset， NULL， NULL， NULL);		监听文件描述符集合对应事件。

	if（ret &gt; 0） {							有监听的描述符满足对应事件
	
		if (FD_ISSET(lfd, &amp;rset)) {				// 1 在。 0不在。

			cfd = accept（）；				建立连接，返回用于通信的文件描述符

			maxfd = cfd；

			FD_SET(cfd, &amp;allset);				添加到监听通信描述符集合中。
		}

		for （i = lfd+1； i &lt;= 最大文件描述符; i++）{

			FD_ISSET(i, &amp;rset)				有read、write事件

			read（）

			小 -- 大

			write();
		}	
	}
}
</code></pre><h2 id="select%E4%BC%98%E7%BC%BA%E7%82%B9%EF%BC%9A" tabindex="-1">select优缺点： <a class="header-anchor" href="#select优缺点：" aria-label="Permalink to &quot;select优缺点：&quot;">​</a></h2><pre><code>缺点：	监听上限受文件描述符限制。 最大 1024.

	检测满足条件的fd， 自己添加业务逻辑提高小。 提高了编码难度。
(监听3,1023) 就必须循环1000多遍, 效率低

优点：	跨平台。win、linux、macOS、Unix、类Unix、mips

epoll 只能在 linux中用
</code></pre><h2 id="%E8%A1%A5%E5%85%85-1%20select%E5%AE%9E%E4%BE%8B" tabindex="-1">补充-1 select实例 <a class="header-anchor" href="#补充-1 select实例" aria-label="Permalink to &quot;补充-1 select实例&quot;">​</a></h2><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;ctype.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;wrap.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SERV_PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6666</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listenfd, connfd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               // connect fd</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf[BUFSIZ];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         /* #define INET_ADDRSTRLEN 16 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clie_addr, serv_addr;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    socklen_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clie_addr_len;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    listenfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setsockopt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, SOL_SOCKET, SO_REUSEADDR, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">opt, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(opt));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bzero</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_family</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INADDR_ANY);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SERV_PORT);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //---------------------------------------------------------------------------------至此, 是一般的 套接字 前部分</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fd_set rset, allset;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                     // 定义 读集合,被份集合allset</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ret, maxfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, n, i, j;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    maxfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listenfd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       // 最大文件描述符</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    FD_ZERO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       // 清空 监听集合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    FD_SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              // 将待监听fd添加到监听集合中  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    这是 把服务端的 第一个 套接字 作为监听目标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allset;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                      // 备份  实际上, allset是想监听的集合, 后续将一直是   rset既是想监听的集合,又是实际听到的集合,会改变</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(maxfd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rset, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 使用select 监听  ret如果是1, 说明只有 listenfd, 不需要处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;select error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    这里难理解,  这样理解</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    allset里面加入了 listenfd,  而 rset = allset,  那rset里不就肯定有 litenfd了吗, 为什么还要FD_ISSET?</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    注意, 在select里,&amp;rset 是一个 传入传出,  传入有listenfd的rset, 传出的 是实际发生了 读事件的 rset, 所以 当传出的 rset 还有listenfd, 那么就表示 有设备 来请求连接了 ! </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    */</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FD_ISSET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rset)) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        // listenfd 满足监听的 读事件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            clie_addr_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clie_addr) ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            connfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clie_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clie_addr_len);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 建立链接  --- 不会阻塞</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            FD_SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                            // 将新产生的fd,添加到监听集合中, 监听数据读事件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (maxfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connfd)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 // 修改maxfd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                maxfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connfd;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   // 说明select 只返回一个,并且是listenfd, 后续执行无须执行.  46行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //ret如果是1, 说明只有 listenfd, 不需要处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">注意:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">下面这个 for循环,在第一次是不执行的,  根据上面的代码, 第一次 select仅监听 listenfd, 当监听到后, 会产生新的 connfd,然后加入到 监听队列, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">if (ret == 1) 在第一次循环是必然成立的, 因此 第二次循环开始, select 将监听 listenfd 和 connfd , 以此类推, 慢慢的就多了起来</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">而 第二次循环 将 大概率 ret &gt;1, 进入下面的for循环, 开始进行 处理 客户端请求</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listenfd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxfd; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 处理满足读事件的 fd ,   这里见笔记的配图</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FD_ISSET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rset)) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   // 找到满足读事件的那个 fd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                           // 检测到客户端已经关闭链接.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i);                           </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    FD_CLR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 // 将关闭的fd, 移除出监听集合.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;read error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n; j</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        buf[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> toupper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf[j]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, buf, n);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STDOUT_FILENO, buf, n);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>75行配图, 不考虑 listenfd, 从下一个开始</p><p><img src="/mycppnoteweb/assets/select%E9%80%BB%E8%BE%91.C83ZglkV.png" alt="image-20250124161726276"></p><h2 id="%E8%A1%A5%E5%85%85-2%20%E6%95%B0%E7%BB%84%2Bselect%E5%AE%9E%E4%BE%8B(%E7%A8%8D%E5%BE%AE%E9%9D%9E%E9%87%8D%E7%82%B9)" tabindex="-1">补充-2 数组+select实例(稍微非重点) <a class="header-anchor" href="#补充-2 数组%2Bselect实例(稍微非重点)" aria-label="Permalink to &quot;补充-2 数组+select实例(稍微非重点)&quot;">​</a></h2><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;unistd.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;arpa/inet.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;ctype.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;wrap.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SERV_PORT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6666</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, j, n, maxi;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nready, client[FD_SETSIZE];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 /* 自定义数组client, 防止遍历1024个文件描述符  FD_SETSIZE默认为1024 */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxfd, listenfd, connfd, sockfd;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf[BUFSIZ], str[INET_ADDRSTRLEN];</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         /* #define INET_ADDRSTRLEN 16 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr_in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clie_addr, serv_addr;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    socklen_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clie_addr_len;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fd_set rset, allset;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                            /* rset 读事件文件描述符集合 allset用来暂存 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    listenfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, SOCK_STREAM, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setsockopt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, SOL_SOCKET, SO_REUSEADDR, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">opt, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(opt));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    bzero</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_family</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AF_INET;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_addr.s_addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htonl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(INADDR_ANY);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    serv_addr.sin_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> htons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SERV_PORT);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Bind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">serv_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(serv_addr));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    maxfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listenfd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                           /* 起初 listenfd 即为最大文件描述符 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    maxi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                                  /* 将来用作client[]的下标, 初始值指向0个元素之前下标位置 */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FD_SETSIZE; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        client[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                         /* 用-1初始化client[] */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    FD_ZERO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    FD_SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                  /* 构造select监控文件描述符集 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> allset;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                          /* 每次循环时都从新设置select监控信号集 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nready </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(maxfd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rset, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //2  1--lfd  1--connfd</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nready </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            perr_exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;select error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FD_ISSET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rset)) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        /* 说明有新的客户端链接请求 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            clie_addr_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clie_addr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            connfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Accept</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sockaddr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clie_addr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clie_addr_len);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       /* Accept 不会阻塞 */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;received from </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at PORT </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    inet_ntop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(AF_INET, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clie_addr.sin_addr, str, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str)),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    ntohs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(clie_addr.sin_port));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FD_SETSIZE; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (client[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                            /* 找client[]中没有使用的位置 */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    client[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connfd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                         /* 保存accept返回的文件描述符到client[]里 */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FD_SETSIZE) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                              /* 达到select能监控的文件个数上限 1024 */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                fputs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;too many clients</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stderr);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                exit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            FD_SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(connfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                            /* 向监控文件描述符集合allset添加新的文件描述符connfd */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (connfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxfd)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                maxfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connfd;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                 /* select第一个参数需要 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxi)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                maxi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                       /* 保证maxi存的总是client[]最后一个元素下标 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nready </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxi; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                               /* 检测哪个clients 有数据就绪 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((sockfd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client[i]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">FD_ISSET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sockfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rset)) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ((n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sockfd, buf, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf))) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /* 当client关闭链接时,服务器端也关闭对应链接 */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sockfd);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    FD_CLR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sockfd, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">allset);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        /* 解除select对此文件描述符的监控 */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    client[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> n; j</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        buf[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> toupper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(buf[j]);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sockfd, buf, n);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STDOUT_FILENO, buf, n);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nready </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                          /* 跳出for, 但还在while中 */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(listenfd);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-37be3093 data-v-6b2a470d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-6b2a470d><span class="visually-hidden" id="doc-footer-aria-label" data-v-6b2a470d>Pager</span><div class="pager" data-v-6b2a470d><a class="VPLink link pager-link prev" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/3-%E9%BB%91%E9%A9%AClinux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B.html" data-v-6b2a470d><!--[--><span class="desc" data-v-6b2a470d>Previous page</span><span class="title" data-v-6b2a470d>系统编程-3</span><!--]--></a></div><div class="pager" data-v-6b2a470d><a class="VPLink link pager-link next" href="/mycppnoteweb/1-linux%E9%98%B6%E6%AE%B5%E6%B1%87%E6%80%BB/5-%E9%BB%91%E9%A9%AC%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B.html" data-v-6b2a470d><!--[--><span class="desc" data-v-6b2a470d>Next page</span><span class="title" data-v-6b2a470d>网络编程-2</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-1b770e11 data-v-88476a4e><div class="container" data-v-88476a4e><!----><p class="copyright" data-v-88476a4e>Copyright © 2025-present xinghuai</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"1-linux阶段汇总_1-黑马linux系统编程课堂笔记-结合课件看.md\":\"BRx75Ula\",\"1-linux阶段汇总_2-黑马linux系统编程.md\":\"ZLEMj7Vt\",\"1-linux阶段汇总_3-黑马linux系统编程.md\":\"DQRC_oxC\",\"1-linux阶段汇总_4-黑马linux网络编程.md\":\"piWqOmPQ\",\"1-linux阶段汇总_5-黑马网络编程.md\":\"DScH2CPe\",\"1-linux阶段汇总_6-黑马网络编程.md\":\"BqRO5LnQ\",\"1-linux阶段汇总_7-黑马网络编程.md\":\"DByNaKtb\",\"1-linux阶段汇总_8-系统_网络代码练习汇总.md\":\"DHN867QZ\",\"1-linux阶段汇总_linux c一站式学习笔记.md\":\"D9G_3GLW\",\"api-examples.md\":\"B7e-YOhA\",\"index.md\":\"lSx-3cHM\",\"readme.md\":\"B-c1lZsH\",\"中高级c__阶段学习笔记-md_1-中级c__笔记-1.md\":\"BSU5zpPW\",\"中高级c__阶段学习笔记-md_1-中级c__笔记-2.md\":\"Cup3-0HH\",\"中高级c__阶段学习笔记-md_1-中级面试问题汇总.md\":\"D5nMXlgd\",\"中高级c__阶段学习笔记-md_2-高级c__笔记-1.md\":\"DMUvXHys\",\"中高级c__阶段学习笔记-md_2-高级c__笔记-2.md\":\"C-HrruXS\",\"中高级c__阶段学习笔记-md_回调函数.md\":\"BoqoVYsO\",\"中高级c__阶段学习笔记-md_回顾linux的多线程.md\":\"C7SP32fD\",\"数据结构_1-数据结构.md\":\"CiGtMIoq\",\"数据结构_2-数据结构(五大算法之后).md\":\"DiYmI0kI\",\"数据结构_复习-代码.md\":\"pjALHusO\",\"数据结构_数据结构小补充.md\":\"Czqk-qZa\",\"施磊数据库核心_1-数据库笔记.md\":\"DrVH4p7L\",\"施磊数据库核心_2-常用命令.md\":\"CPUknL5n\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"mycpp-note\",\"description\":\"xinghuai的学习笔记\",\"base\":\"/mycppnoteweb/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"home\",\"link\":\"/\"},{\"text\":\"linux\",\"items\":[{\"text\":\"系统编程\",\"collapsed\":false,\"items\":[{\"text\":\"系统编程-1\",\"link\":\"/1-linux阶段汇总/1-黑马linux系统编程课堂笔记-结合课件看\"},{\"text\":\"系统编程-2\",\"link\":\"/1-linux阶段汇总/2-黑马linux系统编程\"},{\"text\":\"系统编程-3\",\"link\":\"/1-linux阶段汇总/3-黑马linux系统编程\"}]},{\"text\":\"网络编程\",\"collapsed\":false,\"items\":[{\"text\":\"网络编程-1\",\"link\":\"/1-linux阶段汇总/4-黑马linux网络编程\"},{\"text\":\"网络编程-2\",\"link\":\"/1-linux阶段汇总/5-黑马网络编程\"},{\"text\":\"网络编程-3\",\"link\":\"/1-linux阶段汇总/6-黑马网络编程\"},{\"text\":\"网络编程-4\",\"link\":\"/1-linux阶段汇总/7-黑马网络编程\"}]},{\"text\":\"练习代码\",\"link\":\"/1-linux阶段汇总/8-系统+网络代码练习汇总\"}]},{\"text\":\"cpp\",\"items\":[{\"text\":\"cpp中级\",\"collapsed\":false,\"items\":[{\"text\":\"cpp中级-1\",\"link\":\"/中高级c++阶段学习笔记-md/1-中级c++笔记-1\"},{\"text\":\"cpp中级-2\",\"link\":\"/中高级c++阶段学习笔记-md/1-中级c++笔记-2\"},{\"text\":\"中级面试\",\"link\":\"/中高级c++阶段学习笔记-md/1-中级面试问题汇总\"}]},{\"text\":\"cpp高级\",\"collapsed\":false,\"items\":[{\"text\":\"cpp高级-1\",\"link\":\"/中高级c++阶段学习笔记-md/2-高级c++笔记-1\"},{\"text\":\"cpp高级-2\",\"link\":\"/中高级c++阶段学习笔记-md/2-高级c++笔记-2\"},{\"text\":\"回调函数\",\"link\":\"/中高级c++阶段学习笔记-md/回调函数\"},{\"text\":\"回顾linux的多线程\",\"link\":\"/中高级c++阶段学习笔记-md/回顾linux的多线程\"}]}]},{\"text\":\"数据结构\",\"items\":[{\"text\":\"数据结构-1\",\"link\":\"/数据结构/1-数据结构\"},{\"text\":\"数据结构-2\",\"link\":\"/数据结构/2-数据结构(五大算法之后)\"},{\"text\":\"老师pdf\",\"link\":\"/数据结构/C++版数据结构和算法课程.pdf\"},{\"text\":\"红黑树扩展\",\"link\":\"/数据结构/红黑树删除节点 - Hide on bush.pdf\"},{\"text\":\"数据结构小补充\",\"link\":\"/数据结构/数据结构小补充\"}]},{\"text\":\"项目\",\"items\":[{\"text\":\"集群聊天服务器\",\"link\":\"/markdown-examples\"},{\"text\":\"mprpc框架\",\"link\":\"/api-examples\"}]},{\"text\":\"mysql\",\"items\":[{\"text\":\"mysql-1\",\"link\":\"/施磊数据库核心/1-数据库笔记\"},{\"text\":\"常用命令小总结\",\"link\":\"/施磊数据库核心/2-常用命令\"}]}],\"sidebar\":[{\"text\":\"linux\",\"items\":[{\"text\":\"系统编程\",\"collapsed\":false,\"items\":[{\"text\":\"系统编程-1\",\"link\":\"/1-linux阶段汇总/1-黑马linux系统编程课堂笔记-结合课件看\"},{\"text\":\"系统编程-2\",\"link\":\"/1-linux阶段汇总/2-黑马linux系统编程\"},{\"text\":\"系统编程-3\",\"link\":\"/1-linux阶段汇总/3-黑马linux系统编程\"}]},{\"text\":\"网络编程\",\"collapsed\":false,\"items\":[{\"text\":\"网络编程-1\",\"link\":\"/1-linux阶段汇总/4-黑马linux网络编程\"},{\"text\":\"网络编程-2\",\"link\":\"/1-linux阶段汇总/5-黑马网络编程\"},{\"text\":\"网络编程-3\",\"link\":\"/1-linux阶段汇总/6-黑马网络编程\"},{\"text\":\"网络编程-4\",\"link\":\"/1-linux阶段汇总/7-黑马网络编程\"}]},{\"text\":\"练习代码\",\"link\":\"/1-linux阶段汇总/8-系统+网络代码练习汇总\"}]},{\"text\":\"cpp\",\"items\":[{\"text\":\"cpp中级\",\"collapsed\":false,\"items\":[{\"text\":\"cpp中级-1\",\"link\":\"/中高级c++阶段学习笔记-md/1-中级c++笔记-1\"},{\"text\":\"cpp中级-2\",\"link\":\"/中高级c++阶段学习笔记-md/1-中级c++笔记-2\"},{\"text\":\"中级面试\",\"link\":\"/中高级c++阶段学习笔记-md/1-中级面试问题汇总\"}]},{\"text\":\"cpp高级\",\"collapsed\":false,\"items\":[{\"text\":\"cpp高级-1\",\"link\":\"/中高级c++阶段学习笔记-md/2-高级c++笔记-1\"},{\"text\":\"cpp高级-2\",\"link\":\"/中高级c++阶段学习笔记-md/2-高级c++笔记-2\"},{\"text\":\"回调函数\",\"link\":\"/中高级c++阶段学习笔记-md/回调函数\"},{\"text\":\"回顾linux的多线程\",\"link\":\"/中高级c++阶段学习笔记-md/回顾linux的多线程\"}]}]},{\"text\":\"数据结构\",\"items\":[{\"text\":\"数据结构-1\",\"link\":\"/数据结构/1-数据结构\"},{\"text\":\"数据结构-2\",\"link\":\"/数据结构/2-数据结构(五大算法之后)\"},{\"text\":\"老师pdf\",\"link\":\"/数据结构/C++版数据结构和算法课程.pdf\"},{\"text\":\"红黑树扩展\",\"link\":\"/数据结构/红黑树删除节点 - Hide on bush.pdf\"},{\"text\":\"数据结构小补充\",\"link\":\"/数据结构/数据结构小补充\"}]},{\"text\":\"项目\",\"items\":[{\"text\":\"集群聊天服务器\",\"link\":\"/markdown-examples\"},{\"text\":\"mprpc框架\",\"link\":\"/api-examples\"}]},{\"text\":\"mysql\",\"items\":[{\"text\":\"mysql\",\"link\":\"/施磊数据库核心/1-数据库笔记\"},{\"text\":\"常用命令小总结\",\"link\":\"/施磊数据库核心/2-常用命令\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/xinghuaiaaa/mycpp-note\"}],\"footer\":{\"copyright\":\"Copyright © 2025-present xinghuai\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>